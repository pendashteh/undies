#!/usr/bin/env bash

UNDIES="__"

function __help {
  typeset -F | cut -d' ' -f3- | grep __$ | sort | sed 's|__||g' | grep -v -E 'main' | xargs -I {} printf ' $ %s %s\n' $__app__ {}
}

function __ {
  __app__=$0
  if [ -e "$1" ]; then
    source $(dirname $1)/$(basename $1)
    __app__=$1
    shift
  fi
  test ! -z "$1" && typeset -F ${1}__ >/dev/null && __task__=$1 && shift || __task__='main'
  ${__task__}__ "$@"
}

__ "$@"
